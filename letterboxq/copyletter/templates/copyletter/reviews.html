{% extends 'copyletter/base.html' %} 
{% load static %}

{% block content %}
<div class="container movie-list-wrapper">
    <h1>All Reviews (Newest First)</h1>
    
    {% for entry in reviews %}
        <div class="movie-card-horizontal">
            
            <div class="card-section poster-section">
                {% if entry.movies.poster_url %}
                    <img src="{{ entry.movies.poster_url }}" alt="{{ entry.movies.title }} Poster" class="poster-img">
                {% else %}
                    <img src="{% static 'images/placeholder.png' %}" alt="No Poster" class="poster-img">
                {% endif %}
            </div>

            <div class="card-section info-section">
                <h3 class="movie-title">
                    {{ entry.movies.movie_name|default:entry.movies.movie_name}} ({{ entry.movies.released_year|default:'N/A' }})
                </h3>
                
                <p class="movie-summary review-user-info">
                    ✍️ Reviewed by {{ entry.username.username }}
                </p>
                
                <p class="movie-summary review-comment">
                    "{{ entry.my_review|truncatechars:150|default:'User comment not provided.' }}" 
                </p>
            </div>

            <div class="card-section stats-section">
                
                <div class="stat-item rating-score" style="color: #ffc107;">
                    ⭐️ {{ entry.rate|default:"-" }}/10
                </div>
                
                <div class="stat-item">
                    {% if entry.username == request.user %}
                        <a href="{% url 'delete_review' entry.id %}" 
                           class="action-btn delete-btn" 
                           style="background-color: #dc3545; padding: 5px 15px; font-size: 0.8rem;"
                           onclick="return confirm('Are you sure you want to delete this entry?');">
                           DELETE
                        </a>
                    {% else %}
                        <a href="{% url 'add_watched_movie' entry.movies.id %}" 
                           class="action-btn sign-in-btn" 
                           style="padding: 5px 15px; font-size: 0.8rem;">
                           + LOG
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>
    {% empty %}
    <p class="text-white">No reviews have been posted yet.</p>
    {% endfor %}
</div>
{% endblock %}